{% extends "layout.html" %}

{% block content %}

<div class="content-section">
  <div class="pt-3 mb-4">
    <small class="text-muted">
      <a class="ml-4 link-secondary" href="{{ url_for('home') }}">Back to all recipies</a>
    </small>
    <div class="float-right">
      {%if collections %}
        <small class="text-muted"><b>Collection(s):   </b>{{collections|join(' | ')}} </small>
      {% endif %}
    </div>
  </div>


  <div class="row mb-4">
    <div class="col  d-flex flex-column">
      <div>
        <h1>{{ recipe.name }}</h1>
      </div>
      
      {% if recipe.source_url_short %}
      <div>
          <a href="{{ recipe.source_url }}" target="_blank">{{ recipe.source_url_short }}</a>
      </div>  
      {% elif recipe.source_url %}

      <div class="">
          <a href="{{ recipe.source_url }}" target="_blank">{{ recipe.source_url | truncate(30)}}</a>
      </div>
      {% endif %}

      {% if recipe.whisk_url %}
      <div class=" align-items-end"> 
          <a href="{{ recipe.whisk_url }}" target="_blank">View recipe on Whisk</a>
      </div>
      {% endif %}
      
      {% if note_from_user_list %}
      <div>
        {% for note_from_user in note_from_user_list %}
          <p>{{note_from_user}}</p>
        {% endfor %}
      </div>
      {% endif %}

 
    <div class="float-right mt-auto">
      <form action="#" method="post">
          <span class="fa-solid fa-chart-simple float-right ml-2 align-self-center pt-2"></span>
        
        {% if not is_planned  %}
          <button class="btn btn-outline-info float-left" type="submit" name="button_action" value="add_to_plan">Add to plan</button>
        {% else %}
          <div class="btn btn-static float-left">Added to plan</div>
          <button class="badge badge-pill badge-info float-left ml-2 mt-2" type="submit" name="button_action" value="remove_from_plan">Remove from plan</button>
        {% endif %}

        <button class="btn btn-outline-info float-right" type="submit" name="button_action" value="mark_cooked">{{ cook_count }}  +1 cooked</button>
      </form>

    </div>

      {% if recipe.prep_time or recipe.cook_time or recipe.additional_time or recipe.servings %}
        <!--<div class="row mt-auto ml-1 p-2 bg-light-gray shadow-sm" >   this was used in the past but had too large of a margin at the top-->
        <div class="row mt-3 ml-1 p-2 bg-light-gray shadow-sm" >

          <div class="col-3">
            {% if recipe.prep_time %}
            <b><i class="fa-regular fa-clock mr-1"></i>Prep time:</b> <br> {{ recipe.prep_time }}
            {% endif %}
          </div>
          <div class="col-3">
            {% if recipe.cook_time %}
            <b><i class="fa-regular fa-clock mr-1"></i>Cook time: </b><br>{{ recipe.cook_time }}
            {% endif %}
          </div>
          <div class="col-3">
            {% if recipe.additional_time %}
            <b><i class="fa-regular fa-clock mr-1"></i>Additional time:</b> {{ recipe.additional_time }}
            {% endif %}
          </div>  
          <div class="col-3">
            {% if recipe.servings %}
            <b><i class="fa-solid fa-people-group ml-2 mr-1"></i>Servings:</b> <br>{{ recipe.servings }}
            {% endif %}
          </div>  
        </div>
      {% endif %}
    </div>

    <div class="col-5">
      <img src="{{ url_for('static', filename='recipe_images/' + recipe.image_file) }}" alt="{{ recipe.name }}" class="rounded img-fluid  obj-cover">
    </div>
  </div>
  
  <div class="mb-4">
    <h2>Ingredients</h2>
    <ul class="list-group">
      {% for ingredient in ingredients %}
      <li class="list-group-item">
        <div class="row">
          <div class="col-1">
            <img src="{{ url_for('static', filename='ingredient_images/' + ingredient.name_official + '.jpg') }}">
          </div>
          <div class="col-11">
            {{ ingredient.name_written }}
            <br>
            <small class="text-muted">{{ ingredient.note or '' }}</small>
          </div>
        </div>
      </li>
      {% endfor %}
    </ul>
  </div>
<div class="mb-4">
  <h2 >Instructions</h2>
  <ol>
    {% for instruction in instructions %}
    <li>{{ instruction.text_contents }}</li>
    {% endfor %}
  </ol>
</div>

  {% if source_notes %}
    <h2>Source Notes</h2>
    <ul>
      {% for source_note in source_notes %}
      <li>{{ source_note.text_contents }}</li>
      {% endfor %}
    </ul>
  {% endif %}




  <a href="{{ url_for('edit_recipe', recipe_id=recipe.recipe_id) }}" class="btn btn-outline-info">Edit Recipe</a>
</div>
<p>View count: {{view_count}}</p>

{% endblock %}